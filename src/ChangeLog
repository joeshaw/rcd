2002-05-30  Joe Shaw  <joe@ximian.com>

	* rcd-auth.c: Add a new special auth type, "superuser", which
	grants all rights to any user who has it.

	* rcd-rpc.c (process_rpc_call): Use the new preinvoke method code
	I added to xmlrpc-c to do access control.  It's a lot cleaner, and
	you can't subvert it by using system.multicall(). :)
	(access_control_check): Added.  Does an ACL lookup and check
	before all RPC calls and sets a fault if not approved.
	(unix_rpc_call): Implement identites for Unix domain RPC calls.

	* rcd-unix-server.c (RCDUnixServerCallback): Return a handle which
	contains both the method data and credential info.
	(read_cred): Check to make sure we got valid credentials and put
	that info in the handle.

2002-05-29  Joe Shaw  <joe@ximian.com>

	* rcd-auth.c: Made more extensible for modules by making ACLs
	GQuark based and passing around lists of GQuarks for privileges.

	* rcd-identity.c (rcd_identity_from_password_file):
	* rcd-rpc-packsys.c (rcd_rpc_packsys_register_methods):
	* rcd-rpc-sample.c (rcd_module_load): 
	* rcd-rpc-system.c (rcd_rpc_system_register_methods): Update to
	reflect changes in auth API.

	* rcd-module.c (rcd_module_init): Use rc_debug

	* rcd-prefs.c (rcd_prefs_get_host): Use RC_MAGIC if it is set.

	* rcd-rpc.c (process_rpc_call): Move some shared code between the
	protocols here.

2002-05-29  Jon Trowbridge  <trow@ximian.com>

	* rcd-rpc-packsys.c (packsys_get_channels): Added.
	(add_package_cb): Ref the package, so we don't leave a dangling
	pointer in our world later when we free the list and its contents.
	(rcd_rpc_packsys_register_methods): Register the get_channels
	method.

	* rcd-rpc-util.c (rcd_rc_channel_to_xmlrpc): Added.

	* rcd-query-packages.c: Added.  Implements package queries on top
	of the framework in rcd-query.c.

	* rcd-query.c: Abstracts this code into a generalized querying
	mechanism (which we will be able to also use for log & news
	queries).

	* rcd-subscriptions.c: Added.  Reads and writes the XML file
	containing the subscription information.

	* rcd-fetch.c (rcd_fetch_channel): Use
	rc_world_add_packages_from_buffer so that we get the full benefit
	of the SAX parser.

2002-05-28  Joe Shaw  <joe@ximian.com>

	* rcd-auth.c: Change RCDAuthAction to #defines which can be
	bitwise ORed.
	(rcd_auth_action_to_string): No longer const, can output a list of
	strings
	(rcd_string_to_auth_action): Parses a list of strings and returns
	an RCDAuthAction
	(rcd_auth_approve_action): Ease up on the argument restrictions
	for now.  If RCD_ENFORCE_AUTH is enabled, actually check
	privileges.

	* rcd-identity.c (rcd_identity_from_password_file): Added.  Looks
	for a user in the password file and returns an RCDIdentity with
	its username, password, and privileges.

	* rcd-rpc.c (rcd_rpc_init): Initialize a hash table for storing
	method info.
	(rcd_rpc_register_method): Take an RCDAuthAction parameter
	specifying the privileges required to call this method.  Add
	method info to the hash table.
	(soup_rpc_callback): Authenticate the user from HTTP Basic auth
	against an RCDIdentity from the password file.  Then look up the
	method info from the hash table and call rcd_auth_approve_action()
	to verify the privileges.

	* rcd-rpc-packsys.c (rcd_rpc_packsys_register_methods):
	* rcd-rpc-sample.c (rcd_module_load):
	* rcd-rpc-system.c (rcd_rpc_system_register_methods): Pass in
	privileges required to call these methods.

2002-05-28  Jon Trowbridge  <trow@ximian.com>

	* rcd.c: Added stuff to download channel and package info and to
	use a debug display handler.  Removed some old testing code.

	* rcd-transfer.c: Poked at the various bits of rc_debug-ism.

	* rcd-fetch.c: Added.  Some code for downloading channel and
	package information and storing it in the RCWorld.

	* rcd-cache.c (rcd_cache_open): Don't free cache_fn and tmp_fn
	until we've finished using them.

	* rcd-module.c: Changed to use rc_debug for spew.

	* rcd-prefs.c (rcd_prefs_get_cache_dir): Use a cache file under
	/tmp for now, so there is less warning spew when not running as
	root.

2002-05-24  Joe Shaw  <joe@ximian.com>

	* Makefile.am: Add in rcd-rpc-packsys.[ch], rcd-rpc-util.[ch],
	rcd-unix-server.[ch]: Added these.

	* rcd-rpc.c (unix_rpc_callback): Handle an XML-RPC callback over
	unix domain sockets.
	(rpc_callback, default_callback): Prefix these functions with
	"soup_"
	(server_init): Removed this function, it wasn't long enough to be
	useful.
	(run_server_thread): Move the contents of server_init() here, add
	a call to rcd_unix_server_run_async() for handling requests over
	unix domain sockets.

	* rcd-rpc.h: Move header includes inside of the only-include-once
	#ifdef magic.

	* rcd-rpc-packsys.[ch]: Added.  Contains packaging system RPC
	calls (just query for now).

	* rcd-rpc-util.[ch]: Added.  Contains utility functions for
	converting an RCPackage or RCPackageSList to XML-RPC values and
	XML-RPC values into RCDQueryParts.

	* rcd-unix-server.[ch]: Added.  Lame first cut at doing XML-RPC
	calls over unix domain sockets.

	* rcd.c (initialize_rc_world): Register the packaging system RPC
	methods.

2002-05-24  Joe Shaw  <joe@ximian.com>

	* Makefile.am: Lots of magic

	* rcd-module.c: Added dynamic module loading.

	* rcd-rpc.c:
	* rcd-rpc-system.c:
	* rcd-rpc-sample.c: Added RPC framework with a sample module
	implementation and some system functions (query_module, ping,
	etc.)

	* rcd.c: Initialize the module loader, run a main loop.

2002-05-23  Jon Trowbridge  <trow@ximian.com>

	* rcd-query.c: Added a framework for complex queries.

